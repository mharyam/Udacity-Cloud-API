sudo: required

language: node_js

services:
  - docker

before_install:
  - echo "Testing Docker Hub credentials"
  - docker login -u=$DOCKER_USERNAME -p=$DOCKER_PASSWORD
  - echo "Docker Hub credentials are working"
  - docker build -t build-springxd-base .

script:
  - docker ps -a

after_success:
  - echo "Test Success - Branch($TRAVIS_BRANCH) Pull Request($TRAVIS_PULL_REQUEST) Tag($TRAVIS_TAG)"
  - if [[ "$TRAVIS_BRANCH" == "master" ]]; then echo -e "Push Container to Docker Hub"; fi
  - docker login -u=$DOCKER_USERNAME -p=$DOCKER_PASSWORD
  - export REPO=jayjohnson/springxd-base
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  ###
  - docker build -t udagram-api-feed ./udagram-api-feed
  - docker build -t udagram-api-user ./udagram-api-user
  - docker build -t udagram-reverseproxy ./udagram-reverseproxy
  #Tagging
  - docker tag udagram-api-feed mharyam/udagram-api-feed:v1
  - docker tag udagram-api-user mharyam/udagram-api-user:v1
  - docker tag udagram-reverseproxy mharyam/udagram-api-reverseproxy:v1
  - docker push $REPO
  #PUSH
  - docker push mharyam/udagram-api-feed:v1
  - docker push mharyam/udagram-api-user:v1
  - docker push mharyam/udagram-reverseproxy:v1

# Build